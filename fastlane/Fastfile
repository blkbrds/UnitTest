lane :test do

  keychain_name = "ios-build.keychain"
  keychain_password = "12345678"

  create_keychain(
    name: keychain_name,
    password: keychain_password,
    default_keychain: true,
    unlock: true,
    timeout: 3600,
    add_to_search_list: true
  )

  import_certificate(
    certificate_path: "Cers/Dev.p12",
    certificate_password: ENV["CERTIFICATE_DEV_PASSWORD"] || "default", 
    keychain_name: keychain_name,
    keychain_password: keychain_password
  )

  config_cer_provision(
    profile: "./Cers/Fastlane_dev.mobileprovision",
  )

  build_app(
    scheme: "UnitTestExample",
    configuration: "Debug",
    clean: true,
    output_directory: "ipa/dev",
    output_name: "UnitTest.ipa",
    skip_profile_detection: true,
    silent: true,
    export_method: "development",
    export_options: {
      provisioningProfiles: { "com.lamle.dev.buildappsetting": "Fastlane_dev" }
    }
  )
end
